language: rust
rust:
- stable
dist: trusty
services: docker
sudo: required
env:
  global:
  - CRATE_NAME=catsay
matrix:
  include:
  - env: TARGET=aarch64-unknown-linux-gnu
  - env: TARGET=i686-unknown-linux-gnu
  - env: TARGET=x86_64-unknown-linux-gnu
  - env: TARGET=i686-apple-darwin
    os: osx
  - env: TARGET=x86_64-apple-darwin
    os: osx
before_install:
- set -e
- rustup self update
install:
- sh ci/install.sh
- source ~/.cargo/env || true
script:
- bash ci/script.sh
after_script: set +e
before_deploy:
- sh ci/before_deploy.sh
deploy:
  - provider: releases
    api_key:
      secure: OkrYD4oafM2yYTRtevipngu42yb5CrfMI7/bKYO6XVdMgvywOzVVhSpT4c30H8rEmYlcZOaXS6HCUU4PwEmnLhAq0xYGfBnjQSDZ89lt8UezAIqSRLGuvrr94bMmFpnoH4hzEsu6+bzQqwN4bQncm4I9zXnHHOrcy+h7Z8H/xWR3gWk9K2FOMiblGQ+jXY6jjHtVceks6RP1Ke6K73vPsF/TtcuOFB/VY0O4gwIZuDZuBvwqR34b+IeXv0aVfnqPndk6nNjg+zZUTDHwF4pHMBJVGUEgzSlE9KumSebBi7f8rEPUl9X4y5NChKbeqNF9cFVb3qwTHa8+ghrvUL0Ylm2toOiwwMLV7slE3XxXOzWQ1Bnn7cWLiuBTSjVxCcveRHcWH0P5ZiNamvXXF5+VTrhj0g1CIu09geGPyFCYPaSYa/OGNGMntlBTpFAgW+mLf4HnN/Oaf/g2yDv91SsC4eQk16Mm7dCNNYStQT/CkiJZ21yMJjkgqnmrnvz/jgEVfUGlsugqhX7jZX40rZMQvyYaP+mqLlyZnO7SEocr3FKZZsEcwFDf4d9anPahBNQUOzUVzuHaqnY3v6bZQ7SdDcx7HoA+wnvs/fvaScF4ZiBzgzd35xU50f6gdD3z0FlCu5erEgOp3cdy6+rkN55CxkxERlIOz2zGjW+NkI1oYZM=
    file_glob: true
    file: "$CRATE_NAME-$TRAVIS_TAG-$TARGET.*"
    skip_cleanup: true
    on:
      tags: true
  - provider: launchpad
    slug: "~jimver/catsay"
    oauth_token:
      secure: H1HSqCV8ubk+HWN3Cccc3If9hiDDaLuz21UNKLx3Kh162DaPYYpUyqV1OZj0ohHL1A/lKJBLbOiZJKr9QDGGhy1wKq/KkI2bB+9ze1mEez77mMWdMSKRcm4BZZnvMZb+nE43ihLSnBAHJJ1F4VbX0VOAMLhzXbqr0ccPRckHyFC5tk9Axk40WuDIBU89UU0kitr3DWaRgmEQdog03TlepKaYWsbkAoDIV3tkSjK17P36ZtoxC7e4Reiao+PcGDKCK44iXichQ+5kz+3Mjiw9wEvwhFc3onqPyGs8YQQTb5Q47CKyh7rRBzoJBY4u7KwZKfocN6tsr56qBLfR0hZHBK/VSQhJLkxexUsj3hMvd9VixqKq3cnEgVsktjnLBlycbNjjGnWMoZeaMcYS+4JiYI219C42/wEav4tf5SCsbXyD5vdcvt64qExy5KBlt7c85V/WIBPmfS+vAQGLowmV8nuVCfuvCdCkofgnilgg9l42jtYt7rTD2CP+CaQyIhrEnMqHNERfqlUT4FuKsDZJjDPT9zDpcxFAG+hbW5ODpdPCdGeEkj08LDz6W+enRNT85+AIdmzGCy1IROJabBulWnPZmzAwzNfKkEWC48/qBibuzcaDyRc7m/bO53vTkhmVf1tWS4PqaLdMiDBz89xTbM7ITFNxlNRUJ3LUA0i1fpw=
    oauth_token_secret:
      secure: Ifq3SYSDUkLr1J9xpSBmv565ELmdWHRJyh9vr6PCMuLodQn60CFoS+rdMVtWPleTDPzOjJLA2f/JlRZGwa1sbWqYqaq3ozJou0WqOo9+NjIrl4twOfIVQ/qnqXrHWTpK4/NRM0DWbIKook1IKhYObEjbJ1Ru/NmIhtg+XlDtv1pIDn7dszPecb++d2DQzPIzm7xWtj39yXTAHW1WIJ+vmQ6sC7dbpXIA672WCF5Nv3UE1jT2tKJ+ulVEO6BsExu0PPbolfNWI65N99t5bWcLQnOhQsH/EYEVPB48754nOV2iDpUwBlmtWEamGIeqRnDUBfvolcm+ly5NM+mf/gTNT7rgtyoTOtQH0Z+JuS2lH9rNnibS4WevQA6xYHKfzJ9JIudnhRxaap38nxmWhS+24x1CwoO75g3vLDepy/0la4CIky1JoZ9KeuTEWdjuJXsfbLpmFDegabiWBDaSgN1udGw2kmHSu/wSWushpvC9fxfvLYNhWVLQ2k4S0VwnlD6DcG1zIM53HsoISx9txBt2q8RoPEwoT8QwWIXUnYpN4ozq1LCYHSFbA8zuHc+AmRBkDoD20bJvWJr0/4ptkF4V4nEimeHIaHyXqXhYJ6GVUGWHsZLlukQBxKVFwgPNWx2CJJUbwi5GbSzOC3JGOD+LXtpnkRvJ9u/AUrJ1LEm2w0g=
    skip_cleanup: true
    on:
      tags: true

cache: cargo
before_cache:
- chmod -R a+r $HOME/.cargo
notifications:
  email:
    on_failure: never
    on_success: never
