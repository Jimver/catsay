language: rust
rust:
- stable
dist: trusty
services: docker
sudo: required
env:
  global:
  - CRATE_NAME=catsay
matrix:
  include:
  - env: TARGET=aarch64-unknown-linux-gnu
  - env: TARGET=i686-unknown-linux-gnu
  - env: TARGET=x86_64-unknown-linux-gnu
  - env: TARGET=i686-apple-darwin
    os: osx
  - env: TARGET=x86_64-apple-darwin
    os: osx
before_install:
- set -e
- rustup self update
install:
- sh ci/install.sh
- source ~/.cargo/env || true
script:
- bash ci/script.sh
after_script: set +e
before_deploy:
- sh ci/before_deploy.sh
deploy:
  - provider: releases
    api_key:
      secure: OkrYD4oafM2yYTRtevipngu42yb5CrfMI7/bKYO6XVdMgvywOzVVhSpT4c30H8rEmYlcZOaXS6HCUU4PwEmnLhAq0xYGfBnjQSDZ89lt8UezAIqSRLGuvrr94bMmFpnoH4hzEsu6+bzQqwN4bQncm4I9zXnHHOrcy+h7Z8H/xWR3gWk9K2FOMiblGQ+jXY6jjHtVceks6RP1Ke6K73vPsF/TtcuOFB/VY0O4gwIZuDZuBvwqR34b+IeXv0aVfnqPndk6nNjg+zZUTDHwF4pHMBJVGUEgzSlE9KumSebBi7f8rEPUl9X4y5NChKbeqNF9cFVb3qwTHa8+ghrvUL0Ylm2toOiwwMLV7slE3XxXOzWQ1Bnn7cWLiuBTSjVxCcveRHcWH0P5ZiNamvXXF5+VTrhj0g1CIu09geGPyFCYPaSYa/OGNGMntlBTpFAgW+mLf4HnN/Oaf/g2yDv91SsC4eQk16Mm7dCNNYStQT/CkiJZ21yMJjkgqnmrnvz/jgEVfUGlsugqhX7jZX40rZMQvyYaP+mqLlyZnO7SEocr3FKZZsEcwFDf4d9anPahBNQUOzUVzuHaqnY3v6bZQ7SdDcx7HoA+wnvs/fvaScF4ZiBzgzd35xU50f6gdD3z0FlCu5erEgOp3cdy6+rkN55CxkxERlIOz2zGjW+NkI1oYZM=
    file_glob: true
    file: "$CRATE_NAME-$TRAVIS_TAG-$TARGET.*"
    skip_cleanup: true
    on:
      tags: true
  - provider: launchpad
    slug: "~jimver/catsay"
    oauth_token:
      secure: hFrkwugEZl6MmYQJP3uejhOl6c/EMXhRypCx1W3IgCx+RlBJ7aUOVLgRsX6JKE86Eoyik/0wmhitG+1ojy/ZZvQrXTKk6A7Q6NyTgNUJHBIGvV3rdg3WbxfN+eMr/sYnKg+u5/iA+wyYDfQIMVag4VHCvzDHhLthhO60Rcv3DuUzxawa5lDZXzeUg/7LMqyPsnFeFKhp+koaH9Fnj1QYYjDCYv+YChY9cgOaAMmmEkAdumgId6+2yQLqMcbGp5ZQtKEKbpyD5/DVJ0fiHMYET88mv9NsEl0RQvD6RDjoWmkzN1FBpq0o8JvJjvGaJs3zfVEDJ6wWHxrJ/XMIQeFX3iN/z8BchtVUD2xrmWL7/U/aCaXTp+LpAq/2SS178McG92uY9QuARUV6V3RBMl1H26ixthJwiy7EZ+wAuGEc1PSo1QcTJqV4msmUGJpnGzEnwdQnXLMx4hhNXbvd5HzUyObPHwOXuEw6VSVy03OIb+h6nhCFVqnjv14oaFu/K4wYkeN9OoPKqM/HEd1kF0BZ8q1nXziOpX6xrZCB30eXwVGzScdQtF2UTqi/uzsrL/wC0ZvXs3wl7IS2UnbqImK4xZ2EU3iCLQpctm0//sIjK2dNXVcAhVofnGCd0U8OGHrtvA3t1OEBgfT/msXcLAFBBt0wLmQIeE5bbN/dgDrkOLs=
    oauth_token_secret:
      secure: ezcVXrka0DvpxBJqX+RBk2BaQHKFCoDYyqKLSrE9bb2VK6w2+DIM//+EL9EvzhK97TOFigsMkPHLyKxiH1AI/XyVcKpzVOWBQiRRE5G5Sq1+CvaI4gds1x/eslD1nGLg3tZsxgSKYeAWcZMkUbB1qbz1FHZXzkhmwa2TAFMhMzrAiiz/QUxIOv4cVFrXNH+cBHiPOulrD+IKqODgMzLkv5wgPZD+g80vtow07mO2mJ0hcEQs8+AqKuY/k3COx+uUrumEenINNdIP5rbTfZmk9933s2TrIEC3FtVfzElArpSHbaLntk2tEQqwYjn8q3on2K24u6H9dTSKw25hXIIyT0z9PdvRw078yPSLj7oeT+FHdkQoAOHcKBKDwcRRrZ5BRuIucvoYWekhjdlm29HkCTtZ6Qjih96Gm2D/sW5Atu2G21bHqMb6QBTNIKbaEzUNBimXEowg5wnvmvLVSid/NYfsyKuclETGVPPrAZNrj5qGdz7SgB9Eg5w+Ww2OR9J78CrTK2Hg1RNmh8hsVu4FJi0XRxM0UMQfBSTjG8KUHF627ZLZBdYSn2mlVMKniDjj3zlO4bpn+oa6rcU0Sh7tXPZFBII3tVwLvwL1t5HwSnUcOJJpi+MaPGVKb2sIAxEZmz5uXCSfGAaYEINK1uj4jIlq5iGSDHqZ1pDUJ3xjrRU="
    on:
      tags: true

cache: cargo
before_cache:
- chmod -R a+r $HOME/.cargo
notifications:
  email:
    on_failure: never
    on_success: never
